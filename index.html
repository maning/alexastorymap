<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Alexa's Story of Jesus</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; right:500; top:0; bottom:0; width:100%; }
</style>
</head>
<body>

<style>
article {
  position:absolute;
  top:0;
  right:0;
  bottom:0px;
  left:0;
  overflow:auto;
  }
.quiet {
  color:rgba(0,0,0,0.5);
  }
.scroll {
  display:block;
  text-align:center;
  }
.sections {
  background:rgba(255,255,255,0.5);
  width:40%;
  }
section {
  padding:20px;
  color:rgba(0,0,0,0.5);
  -webkit-transition:background 500ms, color 500ms;
          transition:background 500ms, color 500ms;
  }
section.active {
  background:#fff;
  color:#404040;
  }
</style>
<div id='map'></div>

<article id='narrative'>
  <div class='sections prose'>
    <section id='cover' class='cover active'>
      <h2>The Stories of Jesus</h2>
      <p>by Alexa Antoinette Sambale</p>
<img width="100%" src=https://farm6.staticflickr.com/5612/15776718791_4b1a6be41f_n.jpg alt="H"/>
      <small class='scroll quiet'>Scroll &#x25BE;</small>
    </section>
    <section id='palmsunday'>
      <h3>Into the City</h3>
<img width="100%" src=https://farm8.staticflickr.com/7475/15847228437_6a740e9cb8_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='bethany'>
      <h3>His BFF Lazarus</h3>
<img width="100%" src=https://farm8.staticflickr.com/7521/15780181922_e12c1dab58_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='jacobswell'>
      <h3>With the lady at the well</h3>
<img width="100%" src=https://farm8.staticflickr.com/7504/15776735911_3e8b259681_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='fishersofmen'>
      <h3>Fishers of men</h3>
<img width="100%" src=https://farm8.staticflickr.com/7532/16031028561_662d9ae7a1_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='gloucester'>
      <h3>Not sure what this is</h3>
<img width="100%" src=https://farm6.staticflickr.com/5603/15593447007_c1552437ac_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='caulfield-gardens'>
      <h3>The third day</h3>
<img width="100%" src=https://farm8.staticflickr.com/7465/15592767409_24dd201446_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='ghost'>
      <h3>With his friends</h3>
      <img width="100%" src=https://farm8.staticflickr.com/7582/15845673750_98894d729d_n.jpg alt="H"/>
      <p>Lorem.</p>
    </section>
    <section id='charing-cross'>
      <h3>With mother</h3>
<img width="100%" src=https://farm8.staticflickr.com/7571/15845723410_d4ea6c1539_n.jpg alt="H"/>
      <p>Lorem.</p>
      <small class='colophon'>
        Stories and <a href='https://www.flickr.com/photos/esambale/sets/72157646938248864/'>sketches</a> by <a href='https://www.___'>Alexa</a>, cartography by  <a href='http://mapbox.com'>MapBox</a>, locations from Wikipedia, source at <a href='https://github.com/maning/alexastorymap'>GitHub</a>. 


      </small>
    </section>
  </div>
</article>

<script>
L.mapbox.accessToken = 'pk.eyJ1Ijoic2FtYW4iLCJhIjoiS1ptdnd0VSJ9.19qza-F_vXkgpnh80oZJww';
// In this case, we just hardcode data into the file. This could be dynamic.
// The important part about this data is that the 'id' property matches
// the HTML above - that's how we figure out how to link up the
// map and the data.
var places = { type: 'FeatureCollection', features: [
{ geometry: { type: "Point", coordinates: [35.2598, 32.7040] },
  properties: { id: "cover", zoom: 8 }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [35.2247239, 31.7774287] },
  properties: { id: "palmsunday" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [35.2613, 31.7714] },
  properties: { id: "bethany" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [35.2778, 32.2119] },
  properties: { id: "jacobswell" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [35.5949, 32.8878] },
  properties: { id: "fishersofmen" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [-0.18335806, 51.49439521] },
  properties: { id: "gloucester" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [-0.19684993, 51.5033856] },
  properties: { id: "caulfield-gardens" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [35.5979, 32.8848] },
  properties: { id: "ghost" }, type: 'Feature' },
{ geometry: { type: "Point", coordinates: [35.2300, 31.7839] },
  properties: { id: "mother" }, type: 'Feature' }
]};

var map = L.mapbox.map('map', 'saman.ed44282c', {
    zoomControl: false
});

var placesLayer = L.mapbox.featureLayer(places)
    .addTo(map);

// Ahead of time, select the elements we'll need -
// the narrative container and the individual sections
var narrative = document.getElementById('narrative'),
    sections = narrative.getElementsByTagName('section'),
    currentId = '';

setId('cover');

function setId(newId) {
    // If the ID hasn't actually changed, don't do anything
    if (newId === currentId) return;
    // Otherwise, iterate through layers, setting the current
    // marker to a different color and zooming to it.
    placesLayer.eachLayer(function(layer) {
        if (layer.feature.properties.id === newId) {
            map.setView(layer.getLatLng(), layer.feature.properties.zoom || 14);
            layer.setIcon(L.mapbox.marker.icon({
                'marker-color': '#a8f'
            }));
        } else {
            layer.setIcon(L.mapbox.marker.icon({
                'marker-color': '#404040'
            }));
        }
    });
    // highlight the current section
    for (var i = 0; i < sections.length; i++) {
        sections[i].className = sections[i].id === newId ? 'active' : '';
    }
    // And then set the new id as the current one,
    // so that we know to do nothing at the beginning
    // of this function if it hasn't changed between calls
    currentId = newId;
}

// If you were to do this for real, you would want to use
// something like underscore's _.debounce function to prevent this
// call from firing constantly.
narrative.onscroll = function(e) {
    var narrativeHeight = narrative.offsetHeight;
    var newId = currentId;
    // Find the section that's currently scrolled-to.
    // We iterate backwards here so that we find the topmost one.
    for (var i = sections.length - 1; i >= 0; i--) {
        var rect = sections[i].getBoundingClientRect();
        if (rect.top >= 0 && rect.top <= narrativeHeight) {
            newId = sections[i].id;
        }
    };
    setId(newId);
};
</script>

</body>
</html>

